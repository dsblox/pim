<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"> 
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Trying Bootstrap 4 - move into correct place later -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

<script src="https://use.fontawesome.com/041d5ecc63.js"></script>

<!-- LOCAL VERSIONS 3.3.7 
<link rel="stylesheet" href="bootstrap/3.3.7/css/bootstrap.min.css">
<script src="jquery/3.2.1/jquery.min.js"></script>
<script src="bootstrap/3.3.7/js/bootstrap.min.js"></script
-->
<script src="vue/2.6.11/vue.js"></script>

<!-- CDN VERSIONS -->
<!-- link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous" -->
<!-- script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script -->
<!-- script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script -->
<!-- script src="https://unpkg.com/vue"></script -->

<!-- the following three libraries I believe I tried using but never actually used -->
<!-- script src="https://unpkg.com/axios@0.12.0/dist/axios.min.js"></script -->
<!-- script src="https://unpkg.com/lodash@4.13.1/lodash.min.js"></script -->
<!-- script src="https://cdnjs.cloudflare.com/ajax/libs/vue-strap/1.1.29/vue-strap.min.js"></script -->

<!-- my CSS overrides -->
<link rel="stylesheet" href="pim.css">
<script src="pim-bootstrap.js"></script>

<!-- The following must be in order - look for a new tool to improve this -->
<script src="pim-ajax.js"></script>
<script src="pim-task.js"></script>
<script src="pim-tasklist.js"></script>
<script src="pim-taskvue.js"></script>
<script src="pim-taskajax.js"></script>
<script src="pim-task-changes.js"></script>
<script src="pim-taskdragdrop.js"></script>

</head>

<body>

<nav class="navbar navbar-default navbar-expand-sm navbar-light bg-light rounded">
  <a class="navbar-brand" href="#">PIM</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsCollapsible" aria-controls="navbarsCollapsible" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarsCollapsible">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item active">
        <a class="nav-link" href="vuepim.html">Home <span class="sr-only">(current)</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="planning.html">Planning</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="whatidid.html">History</a>
      </li>
      <li class="nav-item">
        <a class="nav-link disabled" href="#">Mission</a>
      </li>
    </ul>
    <div class="nav navbar-nav nav-center">
        <div class="alert-float" style="position: absolute; top: 0; left: 10px; right: 10px; z-index: 9999; width: 100%" id="err">
          <div class="alert alert-danger alert-dismissible show" role="alert" id=errortext>
            OK
            <button type="button" class="close" aria-label="Close" onclick="$('#err').hide()">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
        </div>
    </div>    
    <ul class="nav navbar-nav ml-auto">
      <li class="nav-item">
        <a class="nav-link" href="#"><span class="fa fa-user"></span> Sign Up</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#"><span class="fa fa-sign-in"></span> Login</a>
      </li>
    </ul>    
  </div>
</nav>

<!--  boostrap 3 
<nav navbar-default>
  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand" href="#">PIM</a>
    </div>
    <ul class="nav navbar-nav">
      <li class="active"><a href="vuepim.html">Today</a></li>
      <li><a href="planning.html">Planning</a></li> 
      <li><a href="whatidid.html">History</a></li> 
      <li><a href="#">Mission</a></li> 
    </ul>
    <ul class="nav navbar-nav nav-center">
        <div class="alert-float" style="position: absolute; top: 0; left: 10px; right: 10px; z-index: 9999; width: 100%" id="err3">
          <div class="alert alert-danger alert-dismissible show" role="alert" id=errortext>
            OK
            <button type="button" class="close" aria-label="Close" onclick="$('#err').hide()">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
        </div>
    </ul>    
    <ul class="nav navbar-nav navbar-right">
      <li><a href="#"><span class="glyphicon glyphicon-user"></span> Sign Up</a></li>
      <li><a href="#"><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
    </ul>
  </div>
</nav> -->

<div id="pim-root" class="container-fluid">

<div class="row ml-0 mr-0 mb-0 p-0">
  <pim-navbar-test />
</div>

<div class="row ml-0 mr-0 mb-0 p-0">
  <pim-title-bar title="Today" :tags="allTags" :selected="selectedTags" :add="true" />
</div>

<div class="row">

  <div class="col-sm-4 pl-3 pr-1">
    <pim-task-list :task-list="scheduled" title="Calendar" v-on:toggle="adjustTask"/>
  </div>


  <div class="col-sm-4 pl-1 pr-1">
    <pim-task-list :task-list="stuff" title="Stuff To Do" v-on:toggle="adjustTask"/>
  </div>

  <div class="col-sm-4 pl-1 pr-3">
    <div class="row">
        <div class="col-sm-12">
          <pim-task-list :task-list="inprogress" title="In Progress" v-on:toggle="adjustTask" hidewhenempty="true"/>
        </div>
    </div>
    <div class="row">
      <div class="col-sm-12">
        <pim-task-list :task-list="done" title="Done" clear="today" v-on:toggle="adjustTask" />
      </div>
    </div>
  </div>

</div>

</div>


<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title" id="myModalLabel">Create New Task</h4>
      </div>
      <form id="newTask" action="createTask">
        <div class="modal-body">
          <div class="form-group">
            <label for="task">Task:</label>
            <input type="text" class="form-control" id="task" aria-describedby="taskHelp" placeholder="Enter task name">
            <small id="taskHelp" class="form-text text-muted">Short summary name for your task.</small>
          </div>
          <div class="form-group">
            <label for="startdate">Start Date:</label>
            <input type="date" class="form-control" id="startdate">
          </div>
          <div class="form-group">
            <label for="starttime">Start Time:</label>
            <input type="time" class="form-control" id="starttime">
          </div>
          <div class="form-group">
            <label for="duration">Estimate (minutes):</label>
            <input type="number" class="form-control" id="duration">
          </div>
          <div class="form-group">
            <label for="tags">Tags:</label>
            <input type="text" class="form-control" id="tags">
            <a href="#" class="badge alert-info">Personal</a>
            <pim-tagpicker :tags="currTags" :selected="selectedTags" :tiles=true :menu=false />
          </div>
          <input type="hidden" id="today" value="true">
          <input type="hidden" id="thisweek" value="false">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-warning" data-dismiss="modal" onclick="deleteTask()" id="delete">Delete Task</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="cancelModal()" id="cancel">Cancel</button>
          <button type="submit" class="btn btn-primary" data-dismiss="modal" onclick="upsertTask('today')" id="save">Save Task</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>


// error block in center of nav to display dismissable errors
// leaving the text-set here to remind me that the hide/show is
// on a different element than the text itself.  Note the alert()
// call resets the close box.  Danger - close() currently deletes
// the alert - we just want it to hide on clicking the x.
// I'm not actually using this yet - but it's here when I need it
// pimShowError("my error text");
$('#err').hide();
$('#err3').hide();


// handle the DISPLAY of the New/Edit Modal Dialog
// we did all this list to track which list to ad to, then realized
// we'd prefer to use whether or not the user entered a time to
// decide which list to put the new task into.  oh well.
var currList = null;
var currTask = null; // remember it so we don't have to look it up again on submit
$('#myModal').on('show.bs.modal', function (event) {

    // find any data the invocation is trying to send us
  	var button = $(event.relatedTarget) // Button that triggered the modal
  	currList = taskListFromID(button.data('list')) // Extract info from data-* attributes
  	currTask = findTask(button.data('taskid'))

  	// initialize or clear the modal's form fields
  	var title = null;
  	var f = document.getElementById("newTask");
  	if (currTask != null) {
  		title = "Edit Task: " + currTask.name
  		f.elements["task"].value = currTask.name;
      f.elements["startdate"].value = extractDateString(currTask.getTargetStartTime());
  		f.elements["starttime"].value = extractTimeString(currTask.getTargetStartTime());
  		f.elements["duration"].value = currTask.estimate;
  		f.elements["delete"].style.visibility = 'visible';

      var tags = currTask.getTags()
      f.elements["tags"].value = tags;
      /*
      while (currTags.length) {
        currTags.pop()
      }
      if (tags != null && tags.length > 0) {
        tags.forEach(t => currTags.push(t)) 
      }
      */


  	} else {
  		title = "Create New Task";
  		f.elements["task"].value = null;
  		f.elements["startdate"].value = new Date().toISOString().split('T')[0];
      f.elements["starttime"].value = null;
  		f.elements["duration"].value = null;
      f.elements["tags"].value = null;
  		f.elements["delete"].style.visibility = 'hidden';  	
  	}
  	
	// now initialize the box with that information
  	var modal = $(this)
  	modal.find('.modal-title').text(title)
})

// call the server to get tasks and put into the lists
currentPage = "today"
loadTasksToday();

// all the tags are loaded into global allTags
tagsFindAll();


// here is a root Vue to hold references to my models
// the data references can be linked to components
new Vue({
  el: '#pim-root',
  data: {
    scheduled: scheduled,
    stuff: stuff,
    done: done,
    inprogress: inprogress,
    states: TaskState,
    selectedTags: selectedTags,
    allTags: allTags,
    currTags: currTags,
    test: "All"
  },
  methods: {
    adjustTask: function(task) { 
      toggleTask(task)
    }
  },
})

</script>

</body>
</html>