<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"> 
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- LOCAL VERSIONS -->
<link rel="stylesheet" href="bootstrap/3.3.7/css/bootstrap.min.css">
<script src="jquery/3.2.1/jquery.min.js"></script>
<script src="bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="vue/2.6.11/vue.js"></script>

<!-- CDN VERSIONS -->
<!-- link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous" -->
<!-- script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script -->
<!-- script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script -->
<!-- script src="https://unpkg.com/vue"></script -->

<!-- the following three libraries I believe I tried using but never actually used -->
<!-- script src="https://unpkg.com/axios@0.12.0/dist/axios.min.js"></script -->
<!-- script src="https://unpkg.com/lodash@4.13.1/lodash.min.js"></script -->
<!-- script src="https://cdnjs.cloudflare.com/ajax/libs/vue-strap/1.1.29/vue-strap.min.js"></script -->

<!-- The following must be in order - look for a new tool to improve this -->
<script src="pim-ajax.js"></script>
<script src="pim-task.js"></script>
<script src="pim-tasklist.js"></script>
<script src="pim-taskvue.js"></script>
<script src="pim-taskajax.js"></script>
<script src="pim-task-changes.js"></script>
<script src="pim-taskdragdrop.js"></script>

</head>

<body>
<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand" href="#">PIM</a>
    </div>
    <ul class="nav navbar-nav">
      <li><a href="vuepim.html">Today</a></li>
      <li class="active"><a href="planning.html">Planning</a></li> 
      <li><a href="whatidid.html">History</a></li> 
      <li><a href="#">Mission</a></li> 
    </ul>
    <ul class="nav navbar-nav navbar-right">
      <li><a href="#"><span class="glyphicon glyphicon-user"></span> Sign Up</a></li>
      <li><a href="#"><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
    </ul>
  </div>
</nav>

<div id="pim-root" class="container-fluid">

<h1 class="text-center bg-primary lead">
	Daily Planning
</h1>

<div class="row">

  <div class="col-sm-6">
    <pim-task-list :task-list="planWeek" title="Weekly Goals" add="true" week="true" v-on:toggle="adjustTask" />
  </div>


  <div class="col-sm-6">
    <pim-task-list :task-list="planDay" title="Daliy Goals" add="true" day="true" v-on:toggle="adjustTask" />
  </div>

</div>

</div>

<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title" id="myModalLabel">Create New Task</h4>
      </div>
      <form id="newTask" action="createTask">
        <div class="modal-body">
          <div class="form-group">
            <label for="task">Task:</label>
            <input type="text" class="form-control" id="task" aria-describedby="taskHelp" placeholder="Enter task name">
            <small id="taskHelp" class="form-text text-muted">Short summary name for your task.</small>
          </div>
          <div class="form-group">
            <label for="startdate">Start Date:</label>
            <input type="date" class="form-control" id="startdate">
          </div>
          <div class="form-group">
            <label for="starttime">Start Time:</label>
            <input type="time" class="form-control" id="starttime">
          </div>
          <div class="form-group">
            <label for="durartion">Estimate (minutes):</label>
            <input type="number" class="form-control" id="duration">
          </div>
          <input type="hidden" id="today" value="false">
          <input type="hidden" id="thisweek" value="true">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-warning" data-dismiss="modal" onclick="deleteTask()" id="delete">Delete Task</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="cancelModal()" id="cancel">Cancel</button>
          <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="upsertTask('planning')" id="save">Save Task</button>
        </div>
      </form>
    </div>
  </div>
</div>


<script>


// handle the DISPLAY of the New/Edit Modal Dialog
// we did all this list to track which list to ad to, then realized
// we'd prefer to use whether or not the user entered a time to
// decide which list to put the new task into.  oh well.
var currList = null;
var currTask = null; // remember it so we don't have to look it up again on submit
$('#myModal').on('show.bs.modal', function (event) {

	// find any data the invocation is trying to send us
  	var button = $(event.relatedTarget); // Button that triggered the modal
  	currList = taskListFromID(button.data('list')) // Extract info from data-* attributes
  	currTask = findTask(button.data('taskid'));
    console.log("button.text = " + button.text);
    console.log("button" , button);    
    console.log("taskid = " + button.data('taskid'));
    // console.log(currList.numTasks());

  	// initialize or clear the modal's form fields
  	var title = null;
  	var f = document.getElementById("newTask");
  	if (currTask != null) {
  		title = "Edit Task: " + currTask.name;
  		f.elements["task"].value = currTask.name;
      f.elements["startdate"].value = extractDateString(currTask.getTargetStartTime());
  		f.elements["starttime"].value = extractTimeString(currTask.getTargetStartTime());
  		f.elements["duration"].value = currTask.estimate;  	
  		f.elements["delete"].style.visibility = 'visible';

  	} 
    else if (currList != null) {
      if (currList.getId() == "PW") {
  		  title = "Create New Week-Level Task";
        f.elements["thisweek"].value = true;
        f.elements["today"].value = false;
      }
      else if (currList.getId() == "PD") {
        title = "Create New Day-Level Task";
        f.elements["thisweek"].value = false;
        f.elements["today"].value = true;
      }
      else {
        title = "Create New Task";        
      }
  		f.elements["task"].value = null;
  		f.elements["startdate"].value = new Date().toISOString().split('T')[0];
      f.elements["starttime"].value = null;
  		f.elements["duration"].value = null;
  		f.elements["delete"].style.visibility = 'hidden';  	
  	}
  	
	// now initialize the box with that information
  	var modal = $(this)
  	modal.find('.modal-title').text(title)
})

// call the server to get tasks and put into the lists
loadTasksThisWeek();
loadTasksThisDay();

// here is a root Vue to hold references to my models
// the data references can be linked to components
new Vue({
  el: '#pim-root',
  data: {
    scheduled: scheduled,
    stuff: stuff,
    done: done,
    planWeek : planWeek,
    planDay : planDay,
    states: TaskState
  },
  methods: {
    adjustTask: function(task) { 
      toggleTask(task)
    }
  },
})

</script>
</body>
</html>